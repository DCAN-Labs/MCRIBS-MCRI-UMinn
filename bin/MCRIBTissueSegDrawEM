#!/bin/bash

INDIR=RawT2RadiologicalIsotropic

if [ -z "$1" ]
then
	echo "Usage $0 <subjid>"
	exit
fi

if [ -z "$2" ]
then
	SUBJAGE=40
else
	SUBJAGE=$2
fi

SUBJID=$1

DRAWEMOUTDIR=TissueSegDrawEM/$SUBJID
OUTDIR=TissueSeg

if [ ! -f "$INDIR/${SUBJID}.nii.gz" ]
then
	echo "Input file not found"
else
	mkdir -p $DRAWEMOUTDIR
	echo `dirname $0`/../lib/DrawEM/pipelines/neonatal-pipeline-v1.1.sh $INDIR/${SUBJID}.nii.gz $SUBJAGE -d $DRAWEMOUTDIR -t `nproc` -c 0 -p 1 -v 1

# copy the brain mask and label files to the global tissue seg directory
	cp $DRAWEMOUTDIR/segmentations/${SUBJID}_brain_mask.nii.gz $OUTDIR
	cp $DRAWEMOUTDIR/segmentations/${SUBJID}_all_labels.nii.gz $OUTDIR
fi
